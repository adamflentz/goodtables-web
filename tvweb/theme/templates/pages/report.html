{% extends 'base.html' %}


{% block content %}

{% if report %}

{% set summary = report.summary %}
{% set columns = report.summary.columns %}
{% set total_row_count = summary.total_row_count %}
{% set total_column_count = columns|length %}
{% set bad_column_percent = ((summary.bad_column_count / total_column_count) * 100)|int %}
{% set bad_row_percent = ((summary.bad_row_count / total_row_count) * 100)|int %}
{% set bad_cell_count = 10 %}
{% set results = [
{'data': {'this': ['first', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15']}},
{'data': {'this': ['second', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15']}},
{'data': {'this': ['third', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15']}}

] %}

<h1>
    {% trans %}Report{% endtrans %}
    {% if permalinks %}
    <span class="pull-right">
        <a class="btn btn-primary" href="{{ permalinks.json }}" title="">JSON Link</a>
        <a class="btn btn-primary" href="{{ permalinks.html }}" title="">HTML Link</a>
    </span>
    {% endif %}
</h1>

<section id="report">

    <div id="bottom-line">

        {% if success -%}

        <h2><span class="text-success">{% trans %}Well done! The data source is valid.{% endtrans %}</span></h2>
        <p class="lead">{% trans %}You can find a brief summary of the data source below.{% endtrans %}</p>

        {%- else -%}

        <h2><span class="text-danger">{% trans %}Oops. the data source is not valid.{% endtrans %}</span></h2>
        <p class="lead">{% trans %}That's ok! Let's see what we can do about that using the info we collected along the way.{% endtrans %}</p>

        {%- endif %}

        <p>{% trans %}These results were calculated on <em>{{ datetime }}</em> using this <mark>data</mark> and this <mark>schema</mark>.{% endtrans %}</p>
    </div>

    <div id="summary">

        <h2>{% trans %}Summary{% endtrans %}</h2>

        {% if success %}

        <p class="lead">
            {% trans %}We processed a total of <strong>{{ total_row_count }}</strong> rows. Column-wise, we found <strong>{{ total_column_count }}</strong> columns. It's all good!{% endtrans %}
        </p>

        {% else %}

        <p class="lead">
            {% trans %}We processed a total of <strong>{{ total_row_count }}</strong> rows, of which <strong>{{ bad_row_percent }}%</strong> were found to have invalid data.{% endtrans %}
            {% trans %}When viewing the data column-wise, we found that out of the <strong>{{ total_column_count }}</strong> columns, <strong>{{ bad_column_percent }}%</strong> had invalid data.{% endtrans %}
        </p>
        <p class="lead">
            <u>{% trans %}All in all, a total of <strong>{{ bad_cell_count }}</strong> cells have invalid data. Let's have a look at the details.{% endtrans %}</u>
        </p>

        {% endif %}

    </div>

    {% if success %}

    {% if permalinks %}
    <div id="positive-action">
        <p>
            {% trans %}Let others share in your success!{% endtrans %}
        </p>
        <a class="btn btn-primary" href="{{ permalinks.json }}" title="">JSON Link</a>
        <a class="btn btn-primary" href="{{ permalinks.html }}" title="">HTML Link</a>
    </div>
    {% endif %}

    {% else %}

    <div id="detail">
        <h2>{% trans %}Details{% endtrans %}</h2>
        <p>
            {% trans %}Below we have a snapshot of the first 20 errors found when validating the data. Use this to identify problems, fix them in the source, and then upload the data to validate again!{% endtrans %}
        </p>

        <div id="results-sample" class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>0</th>
                        {% for column in columns %}
                        <th>{{ column.name }} {#({{ column.index }})#}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for result in results %}

                    {# the tr spacing etc is not good semantic markup, but does the job #}

                    <tr class="result-row-group">
                        <td>{{ result.row_index }}</td>
                        {% for cell in result.data.this %}
                        {% if result.column_index and (loop.index == result.column_index) %}
                        {% set cell_class = 'bg-danger' %}
                        {% else %}
                        {# the whole row is errored #}
                        {% set cell_class = 'bg-warning' %}
                        {% endif %}
                        <td class="{{ cell_class }}">{{ cell }}</td>
                        {% endfor %}
                    </tr>

                    <tr class="result-row-spacer"><td></td></tr>

                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% endif %}

</section>
{% else %}
<h1>
    {% trans %}Oops{% endtrans %}.
</h1>
<p>
    {% trans %}There is no report data to display{% endtrans %}.
    <a href="{{ url_for('pages.main') }}" title="{% trans%}Submit some data to validate{% endtrans%}">{% trans %}Submit some data to validate{% endtrans %}.</a>
</p>
{% endif %}

{% endblock content %}
